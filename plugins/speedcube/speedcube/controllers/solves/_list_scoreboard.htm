<?php
$diff = '';

if ($solvesThisMonth > $solvesLastMonth) {
    $diff = 'positive';
}

$username = $topUser && $topUser->user
    ? $topUser->user->username
    : 'Guest';

$completionRate = $totalThisMonth
    ? round(($solvesThisMonth / $totalThisMonth) * 100)
    : 0;

$completionRateLastMonth = $totalLastMonth
    ? round(($solvesLastMonth / $totalLastMonth) * 100)
    : 0;
?>

<style>
#solves-scoreboard [data-control="chart-pie"] tr:nth-child(n + 4) {
    display: none;
}
</style>

<div class="scoreboard" id="solves-scoreboard">
    <div data-control="toolbar">
        <div class="scoreboard-item control-chart" data-control="chart-pie">
            <ul>
                <?php foreach($totals as $puzzle => $total): ?>
                    <li><?= $puzzle ?> <span><?= $total ?></span></li>
                <?php endforeach; ?>
            </ul>
        </div>

        <div class="scoreboard-item title-value">
            <h4>This Month</h4>
            <p class="<?= $diff ?>"><?= $solvesThisMonth ?></p>
            <p class="description">last month: <?= $solvesLastMonth ?></p>
        </div>

        <div class="scoreboard-item title-value" data-control="goal-meter" data-value="<?= $completionRate ?>">
            <h4>Completion</h4>
            <p><?= $completionRate ?>%</p>
            <p class="description">last month: <?= $completionRateLastMonth ?>%</p>
        </div>

        <div class="scoreboard-item title-value">
            <h4>Top User</h4>
            <p class="oc-icon-star"><?= $username ?></p>
            <p class="description"><?= $topUser ? $topUser->total : 0 ?> completed solves</p>
        </div>
    </div>
</div>
  